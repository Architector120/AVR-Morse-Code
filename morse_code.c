/*
 * morse_code.h
 *
 * Created: 22.08.2018 11:45:27
 * Author : Architector120
 * Email  : architector120@cantseeme.xyz
 */

#include <avr/io.h>
#include <avr/pgmspace.h>
#include <util/delay.h>
#include "morse_code.h"

void morse_transmit(char num, char data)
{
	if (num != 0)
	{
		for(uint8_t i = 0; i < num; i++)
		{
			if(data & 0b10000000)
			{
				MORSE_PORT |= (1 << MORSE_PIN);
				_delay_ms(MORSE_DASH);
				MORSE_PORT &=~(1 << MORSE_PIN);
				_delay_ms(MORSE_CHAR_GAP);
			}
			else
			{
				MORSE_PORT |= (1 << MORSE_PIN);
				_delay_ms(MORSE_DOT);
				MORSE_PORT &=~(1 << MORSE_PIN);
				_delay_ms(MORSE_CHAR_GAP);
			}
			data = data << 1;
		}
		_delay_ms(MORSE_LETTER_GAP);
	}
}

void morse_puts(char *puts)
{
	while(*puts > 0)
	{
		morse_putc(*puts++);
	}
}

void morse_putc(char putc)
{
	if (putc == 32)
	{
		MORSE_PORT &=~(1 << MORSE_PIN);
		_delay_ms(MORSE_WORD_GAP);
	}
	if (putc >= 33 && putc <= 126)
	{
		morse_transmit(pgm_read_byte(&(ascii_to_morse[putc-32][0])),pgm_read_byte(&(ascii_to_morse[putc-32][1])));
	}
}

const char ascii_to_morse[95][2] PROGMEM = {
	{0,0b00000000}, // (32) <space>	//NULL
	{6,0b10101100}, // (33)		!
	{6,0b01001000}, // (34)		"
	{0,0b00000000}, // (35)		#	//NULL
	{7,0b00010010}, // (36)		$	//IDK
	{0,0b00000000}, // (37)		%	//NULL
	{5,0b01000000}, // (38)		&
	{6,0b01111000}, // (39)		'
	{5,0b10110000}, // (40)		(
	{6,0b10110100}, // (41)		)
	{0,0b00000000}, // (42)		*	//NULL
	{5,0b01010000}, // (43)		+
	{6,0b11001100}, // (44)		,
	{6,0b10000100}, // (45)		-
	{6,0b01010100}, // (46)		.
	{5,0b10010000}, // (47)		/
	{5,0b11111000}, // (48)		0
	{5,0b01111000}, // (49)		1
	{5,0b00111000}, // (50)		2
	{5,0b00011000}, // (51)		3
	{5,0b00001000}, // (52)		4
	{5,0b00000000}, // (53)		5
	{5,0b10000000}, // (54)		6
	{5,0b11000000}, // (55)		7
	{5,0b11100000}, // (56)		8
	{5,0b11110000}, // (57)		9
	{6,0b11100000}, // (58)		:
	{6,0b10101000}, // (59)		;	//IDK
	{0,0b00000000}, // (60)		<	//NULL
	{5,0b10001000}, // (61)		=
	{0,0b00000000}, // (62)		>	//NULL
	{6,0b00110000}, // (63)		?
	{6,0b01101000}, // (64)		@
	{2,0b01000000}, // (65)		A
	{4,0b10000000}, // (66)		B
	{4,0b10100000}, // (67)		C
	{3,0b10000000}, // (68)		D
	{1,0b00000000}, // (69)		E
	{4,0b00100000}, // (70)		F
	{3,0b11000000}, // (71)		G
	{4,0b00000000}, // (72)		H
	{2,0b00000000}, // (73)		I
	{4,0b01110000}, // (74)		J
	{3,0b10100000}, // (75)		K
	{4,0b01000000}, // (76)		L
	{2,0b11000000}, // (77)		M
	{2,0b10000000}, // (78)		N
	{3,0b11100000}, // (79)		O
	{4,0b01100000}, // (80)		P
	{4,0b11010000}, // (81)		Q
	{3,0b01000000}, // (82)		R
	{3,0b00000000}, // (83)		S
	{1,0b10000000}, // (84)		T
	{3,0b00100000}, // (85)		U
	{4,0b00010000}, // (86)		V
	{3,0b01100000}, // (87)		W
	{4,0b10010000}, // (88)		X
	{4,0b10110000}, // (89)		Y
	{4,0b11000000}, // (90)		Z
	{0,0b00000000}, // (91)		[	//NULL
	{0,0b00000000}, // (92)		\	//NULL
	{0,0b00000000}, // (93)		]	//NULL
	{0,0b00000000}, // (94)		^	//NULL
	{6,0b00110100}, // (95)		_	//IDK
	{0,0b00000000}, // (96)		`	//NULL
	{2,0b01000000}, // (97)		a
	{4,0b10000000}, // (98)		b
	{4,0b10100000}, // (99)		c
	{3,0b10000000}, // (100)	d
	{1,0b00000000}, // (101)	e
	{4,0b00100000}, // (102)	f
	{3,0b11000000}, // (103)	g
	{4,0b00000000}, // (104)	h
	{2,0b00000000}, // (105)	i
	{4,0b01110000}, // (106)	j
	{3,0b10100000}, // (107)	k
	{4,0b01000000}, // (108)	l
	{2,0b11000000}, // (109)	m
	{2,0b10000000}, // (110)	n
	{3,0b11100000}, // (111)	o
	{4,0b01100000}, // (112)	p
	{4,0b11010000}, // (113)	q
	{3,0b01000000}, // (114)	r
	{3,0b00000000}, // (115)	s
	{1,0b10000000}, // (116)	t
	{3,0b00100000}, // (117)	u
	{4,0b00010000}, // (118)	v
	{3,0b01100000}, // (119)	w
	{4,0b10010000}, // (120)	x
	{4,0b10110000}, // (121)	y
	{4,0b11000000}, // (122)	z
	{0,0b00000000}, // (123)	{	//NULL
	{0,0b00000000}, // (124)	|	//NULL
	{0,0b00000000}, // (125)	}	//NULL
	{0,0b00000000}, // (126)	~	//NULL
};